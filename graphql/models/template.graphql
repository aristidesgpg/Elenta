extend type Query {
    getTemplate(id: ID! @eq): Template! @find
    getTemplatesByOwner(consultant_profile_id: ID! @eq(key: "consultant_profile_id")): [Template!]! @all
}

extend type Mutation {
    upsertTemplate(input: UpsertTemplateInput! @spread): Template! @upsert
    syncTemplateModules(input: SyncTemplateModulesInput @spread): Template! @upsert
}

input UpsertTemplateInput {
    id: ID
    owner: ConsultantProfileBelongsTo

    title: String
    can_request: Boolean
    is_public: Boolean
    dynamic_fields: String

    modules: TemplatesBelongsToManyModules
}

input SyncTemplateModulesInput {
    id: ID!
    templateModules: UpdateTemplateModules
}

input UpdateTemplateModules {
    upsert: [SyncTemplateModules!]
}

input SyncTemplateModules {
    id: ID!
    order: String
    folder: String
}

input TemplatesBelongsToManyModules {
    create: [UpsertModuleInput!]
    connect: [ConnectTemplateModule!]
    sync: [ConnectTemplateModule!]
}

input ConnectTemplateModule {
    id: ID!
    folder: String
    order: Int
}

type Template {
    id: ID!
    owner: ConsultantProfile!

    title: String!
    can_request: Boolean!
    is_public: Boolean!
    dynamic_fields: String

    created_at: DateTime!
    updated_at: DateTime!
    deleted_at: DateTime!

    pivot: TemplateModulePivot

    templateModules: [TemplateModule]
    modules: [Module]
    requests: [TemplateRequest]
    programs: [Program]
}

type TemplateModulePivot {
    id: ID!
    folder: String
    order: String
}

type TemplateModule {
    id: ID!
    module: Module

    folder: String
    order: Int!

    created_at: DateTime!
    updated_at: DateTime!
    deleted_at: DateTime!
}
